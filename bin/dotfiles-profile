#!/bin/bash
# dotfiles-profile - Command line utility for managing dotfiles profiles

DOTFILES_DIR="$HOME/Projects/dotfiles"
CONFIG_SCRIPT="$DOTFILES_DIR/bin/generate_config.py"

if [ ! -f "$CONFIG_SCRIPT" ]; then
    echo "Error: Configuration generator script not found at $CONFIG_SCRIPT"
    exit 1
fi

# Display help message
function show_help() {
    echo "dotfiles-profile - Manage dotfiles profiles"
    echo 
    echo "Usage: dotfiles-profile [command]"
    echo "Commands:"
    echo "  list           - List available profiles"
    echo "  show           - Show current profile"
    echo "  set [profile]  - Switch to a different profile"
    echo "  apply          - Reapply current profile configuration"
    echo "  help           - Show this help message"
}

# Get current profile
CURRENT_PROFILE=""
if [ -f "$DOTFILES_DIR/config/.current_profile" ]; then
    CURRENT_PROFILE=$(cat "$DOTFILES_DIR/config/.current_profile")
else
    CURRENT_PROFILE="personal"
fi

# Process commands
case "$1" in
    list)
        python "$CONFIG_SCRIPT" --list
        ;;
    show)
        echo "Current profile: $CURRENT_PROFILE"
        ;;
    set)
        if [ -z "$2" ]; then
            echo "Error: No profile specified"
            echo "Usage: dotfiles-profile set [profile]"
            exit 1
        fi
        # Write the new profile to .current_profile
        echo "$2" > "$DOTFILES_DIR/config/.current_profile"
        python "$CONFIG_SCRIPT" --profile "$2" --apply
        echo "Profile set to $2"
        echo "Please restart your terminal or run 'source ~/.zshrc' for changes to take effect"
        ;;
    apply)
        python "$CONFIG_SCRIPT" --profile "$CURRENT_PROFILE" --apply
        echo "Configuration reapplied for profile: $CURRENT_PROFILE"
        echo "Please restart your terminal or run 'source ~/.zshrc' for changes to take effect"
        ;;
    help)
        show_help
        ;;
    *)
        if [ -z "$1" ]; then
            show_help
        else
            echo "Unknown command: $1"
            echo "Run 'dotfiles-profile help' for usage information"
        fi
        exit 1
        ;;
esac 